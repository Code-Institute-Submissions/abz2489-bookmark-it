# Bugs

## Bugs & Fixes

1. When launching the project for the very first time after creation I received a 400 error "Invalid HTTP_HOST header". This was an easy fix by following the instructions displayed on the error page I added my request URL  to the ALLOWED_HOSTS section of settings.py within the bookmark-it project folder.

<img src="documentation/bugs/bmi-bug1.png" width="500"/>
<img src="documentation/bugs/bmi-fix1.png" width="350"/>

2. db.sqlite3 file is pulling through to github despite being in the .gitignore file. Fixed with the help of Simen Daehlin's very helpful thread in the CI Slack about removing unwanted files using ```git rm -r --cached db.sqlite3 ``` and committing the changes. Due to having to change directory to run the server my db.sqlite3 and requirements.txt files weren't in the root directory.
**Steps taken to fix:**
- Move db.sqlite3 and requirements.txt to the root directory.
- Execute ```git rm -r --cached db.sqlite3 ```
- Commit changes
- Push changes to Github
- Apply migrations ```python3 manage.py migrate```
- Create new super user ```python3 manage.py createsuperuser```

3. The all_books view isn't rendering as a "Home Page" when running the server. Fixed by emptying the path in the project level URLs ```path('books/', include('books.urls'))``` to ```path('', include('books.urls'))```

<img src="documentation/bugs/bmi-bug3.png" width="500"/>
<img src="documentation/bugs/bmi-fix3.png" width="350"/>

4. Mobile book search not showing results. Fixed by comparing the mobile search section with the search section in base.html. The name attribute was missing from mobile. 
The first image shows 15 results when the word "children" was searched, this should show 6 as there are only 6 books in the children's category.

<img src="documentation/bugs/bmi-bug4.png" height="350"/>
<img src="documentation/bugs/bmi-fix4.png" height="350"/>

5. Back to top button being pushed up to middle of page after moving the overlay closing tag. Fixed by moving the back to top button inside the overlay tags.

<img src="documentation/bugs/bmi-bug5.png" height="350"/>
<img src="documentation/bugs/bmi-fix5.png" height="350"/>

6. Quantity increase and decrease buttons on the book summary page aren't working when clicked. The rest of the logic works; disabling the buttons at certain points. Fixed, I was missing a simple hyphen in one of the classes.

7. Quantity increase and decrease buttons work on the book summary page but not on the basket page. I had two different variables for .qty-input in the script; allQtyInputs and allQuantityInputs. Fixed by removing allQuantityInputs and replacing it with allQtyInputs. Both quantity inputs on the book summary page and the basket page now increment and decrement.

8. Basket page not displaying following the addition of my adjust_basket view. The error displayed is "NoReverseMatch at /basket/
Reverse for 'adjust_basket' with arguments '('',)' not found. 1 pattern(s) tried: ['basket/adjust/(?P<book_id>[^/]+)/\\Z']".
Fixed with the help of slack. I had entered the book_id arguement for the form URL and update link URL incorrectly.

<img src="documentation/bugs/bmi-bug8.png" width="500"/>
<img src="documentation/bugs/bmi-fix8.png" width="350"/>

9. Adjusting the quantity input on one book in the basket causes all quantity inputs to change. My qty_input.html had the imcrement and decrement being called on the allQtyInputs variable. I switched this to closestInput which has fixed the issue.

<img src="documentation/bugs/bmi-bug9.png" width="350"/>
<img src="documentation/bugs/bmi-fix9.png" width="350"/>

10. Clicking the update button throws a type error. Fixed by removing a duplicate adjust_basket url from the update link. This fix highlighted and issue in my views, I forgot to import reverse.

11. Remove link on basket page is throwing a 500 error when clicked.Fixed by adding a trailing slash to the url variable in jquery ```let url = `/basket/remove/${bookId}/`;```

12. Book covers on the books page disappeared after adding media context processor to project level settings. Fixed by removing the {{ MEDIA_URL }}.

<img src="documentation/bugs/bmi-bug12.png" width="350"/>
<img src="documentation/bugs/bmi-fix12.png" width="350"/>

13. Import error when trying to run the server due to a circular import. I accidentally imported ```from .webhooks import webhook``` in both webhook_handler.py and webhooks.py. Fixed by removing the import from webhook_handler.py.

<img src="documentation/bugs/bmi-bug13.png" width="500" height="50"/>

14. Media files not loading in the deployed version of Bookmark-It. I had to reach out to tutor support for this one and the fixes are listen below.
    - I had MEDIA_URL on my img src attribute, which is no longer needed due to being overidden in settings.py.
    - I failed to load my fixtures after the first migration to my new DB.
        - We reset my Elephant SQL database.
        - Ran the migrations again.
        - Loaded the categories fixture without issues.
        - Hit a problem with the books fixture. My books model needed big integer for the ISBN number.
        - This allowed us to load the books fixture without issue.

15. Static files not loading in deployed version of Bookmark-It. Chrome Dev tools showed that the files were unauthorised which suggested an issue with my AWS setup. I suspected the issue was the setting I chose for my access key but the problem persisted after changing. I then found some incorrect settings in the Bucket Policy which fixed the problem.

16. Not so much a bug but please note commit fd6b895a6c9ed783c43adb092e5503520356f3b1 revert "Add error pages". I had accidentally used ```git reset --hard``` after the previous commit, f3826f2318a0fa2425caf8a5f6d5c9ccd404dd7a was made which lost my error pages. I decided to revert this commit as the commit message was no longer correct.

17. I accidentally pushed the original Django secret key to github. Before deployment I changed the secret key and put the new one in my environment variables.

# Manual Testing
| Test No: | Feature                                                  | Expected                                                                                                   | Test                                                                                                                                                                                                                                            | Result                                                                                                                                                         | Pass/Fail | Notes                                                                            |
| -------- | -------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | -------------------------------------------------------------------------------- |
| 1        | NAVBAR                                                   |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 1.1      | Logo / brand                                             | Return user to home/books page when clicked from any page                                                  | Click logo/brand from any page except the books page.                                                                                                                                                                                           | Returns user to books                                                                                                                                          | Pass      |                                                                                  |
| 1.2      | Search                                                   | Display error message when no search term entered                                                          | Leave search input blank and click the search button                                                                                                                                                                                            | Pop up alert telling the user that no search crietria was entered is displayed                                                                                 | Pass      |                                                                                  |
| 1.3      |                                                          | Display the books and number of books that match the search criteria                                       | Enter "brother" in the search input and click the search button                                                                                                                                                                                 | Four results matching the search criteria "brother" are displayed                                                                                              |           |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
|          | Navigation Links                                         |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 1.4      | Register, Login  nav links                               | Register & login only visible when no user is logged in                                                    | Log in as user                                                                                                                                                                                                                                  | Before logging in Register & log in is displayed. After logging in the buttons are replaced with profile and logout.                                           | Pass      |                                                                                  |
| 1.5      | Profile nav link                                         | Only visible when a user is logged in                                                                      | If user is logged in log out.                                                                                                                                                                                                                   | The profile button isn't visible                                                                                                                               | Pass      |                                                                                  |
| 1.6      | Book admin nav link                                      | Only visible to superusers when logged in                                                                  | Log in with superuser credentials                                                                                                                                                                                                               | Book admin is visible                                                                                                                                          | Pass      |                                                                                  |
| 1.7      | Register                                                 | Take user to registration page                                                                             | Click Register nav link                                                                                                                                                                                                                         | Navigates to registration page                                                                                                                                 | Pass      |                                                                                  |
| 1.8      | Login                                                    | Take user to login page                                                                                    | Click Login nav link                                                                                                                                                                                                                            | Navigates to login page                                                                                                                                        | Pass      |                                                                                  |
| 1.9      | Books                                                    | Take user to home/books page                                                                               | Click Books nav link                                                                                                                                                                                                                            | Navigates to books page                                                                                                                                        | Pass      |                                                                                  |
| 1.10     | Categories dropdown                                      | Display book categories in a dropdown menu                                                                 | Click categories nav link                                                                                                                                                                                                                       | Displays categories dropdown                                                                                                                                   | Pass      |                                                                                  |
| 1.11     | Category choices                                         | Display books page with only the books from the selected category                                          | Click any category                                                                                                                                                                                                                              | Selected Fiction and the three fiction books displayed                                                                                                         | Pass      |                                                                                  |
| 1.12     | Bookmark Icon                                            | Take user to their bookmarks page                                                                          | Click bookmark icon                                                                                                                                                                                                                             | Navigates to user's bookmark                                                                                                                                   | Pass      |                                                                                  |
|          |                                                          | Only visible when a user is logged in                                                                      | If user is logged in log out.                                                                                                                                                                                                                   | Bookmark not visible                                                                                                                                           | Pass      |                                                                                  |
| 1.13     | Basket Icon                                              | Take user to their basket page                                                                             | Click basket icon                                                                                                                                                                                                                               | Navigates to basket                                                                                                                                            | Pass      |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 2        | FOOTER                                                   |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 2.1      | Instagram Icon                                           | Open instagram in new window                                                                               | Click Instagram icon                                                                                                                                                                                                                            | Opens Instagram in new window                                                                                                                                  | Pass      |                                                                                  |
| 2.2      | Facebook Icon                                            | Open Facebook in new window                                                                                | Click Facebook icon                                                                                                                                                                                                                             | Opens facebook in new window                                                                                                                                   | Pass      |                                                                                  |
| 2.3      | Twitter Icon                                             | Open Twitter in new window                                                                                 | Click X icon                                                                                                                                                                                                                                    | Opens X in new window                                                                                                                                          | Pass      |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 3        | BOOKS PAGE                                               |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 3.1      | Sorting dropdown                                         | Filter books by title, author, price low - high or price high - low, depending on which option is selected | Click a sorting option                                                                                                                                                                                                                          | By title arranges from A-Z, by author arranges alphabetcially and price hi-lo lo-hi all working                                                                | Pass      |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 3.2      | Cover images                                             | Open book detail & summary of clicked book                                                                 | Click cover image                                                                                                                                                                                                                               | Opens book summary                                                                                                                                             | Pass      |                                                                                  |
| 3.3      | Book title & author links                                | Open book detail & summary of clicked title / author                                                       | Click title / author link                                                                                                                                                                                                                       | Opens book summary                                                                                                                                             | Pass      |                                                                                  |
| 3.4      | Books responsiveness                                     | Display books in one column on  mobile screens                                                             | Open dev tools, and select mobile screen (320px - 425px)                                                                                                                                                                                        | Books displayed in one column                                                                                                                                  | Pass      |                                                                                  |
| 3.5      |                                                          | Display books in two columns on tablet screens                                                             | Open dev tools, select tablet screen (768px)                                                                                                                                                                                                    | Books displayed in two columns                                                                                                                                 | Pass      |                                                                                  |
| 3.6      |                                                          | Display books in three columns on smaller laptop screens                                                   | Open dev tools, select laptop screen (10240x)                                                                                                                                                                                                   | Books displayed in three columns                                                                                                                               | Pass      |                                                                                  |
| 3.7      |                                                          | Display books in four columns on larger laptop screens                                                     | Open dev tools, select laptop L screen (1440px)                                                                                                                                                                                                 | Books displayed in four columns                                                                                                                                | Pass      |                                                                                  |
| 3.8      | Back to top button effect                                | Display with fill effect when mouse enters. Returns to normal state when mouse leaves.                     | Hover mouse over arrow button for fill effect. Hover away for original state                                                                                                                                                                    | Button shows pink on hover and returns to white after                                                                                                          | Pass      |                                                                                  |
| 3.9      | Back to top in mobile view                               | Button will display with fill effect on mobile screens                                                     | Open dev tools and select mobile screen (320px-425px)                                                                                                                                                                                           | Button is pink on mobile devices                                                                                                                               | Pass      |                                                                                  |
| 3.10     | Back to top button function                              | Take the user back to the top of the page                                                                  | Click back to top button                                                                                                                                                                                                                        | Takes user back to top of page                                                                                                                                 | Pass      |                                                                                  |
|          |                                                          |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 4        | BOOK SUMMARY PAGE                                        |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 4.1      | Cover image                                              | Open in new window when clicked                                                                            | Click cover image                                                                                                                                                                                                                               | Opens image in new window                                                                                                                                      | Pass      |                                                                                  |
| 4.2      | Plus button                                              | Increase the quantity of books to add to basket.                                                           | Click plus button                                                                                                                                                                                                                               | Increases quantity                                                                                                                                             | Pass      |                                                                                  |
|          |                                                          | Button disables when the quantity  reaches 99                                                              | Enter 99 into the qty input box and try clicking the plus button                                                                                                                                                                                | Button disabled and colour is changed to reflect state                                                                                                         | Pass      |                                                                                  |
| 4.3      | Minus button                                             | Decrease the quantity of books to add to basket                                                            | Click minus button                                                                                                                                                                                                                              | Decreases quantity (if higher than 1 already)                                                                                                                  | Pass      |                                                                                  |
|          |                                                          | Button disables when the quantity  input reads 1 to avoid 0 or negative numbers being selected             |                                                                                                                                                                                                                                                 | Button disabled and colour is changed to reflect state                                                                                                         | Pass      |                                                                                  |
| 4.4      | Buy button                                               | Add selected quantity of books to basket                                                                   | Click buy button                                                                                                                                                                                                                                | Adds item to user's basket                                                                                                                                     | Pass      |                                                                                  |
| 4.5      | Book summary responsiveness                              | Display book detail & summary in on column on mobile screens                                               | Open dev tools, and select mobile screen (320px - 425px)                                                                                                                                                                                        | Displays in one column                                                                                                                                         | Pass      |                                                                                  |
|          |                                                          | Display book detail & summary in two columns anything larger than a mobile screen                          | Open dev tools, and select mobile screen (768px>)                                                                                                                                                                                               | Displays in two columns                                                                                                                                        | Pass      |                                                                                  |
| 5        | BASKET PAGE                                              |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 5.1      | Empty basket                                             | When there are no basket items the page displays a message "your bag is empty" and a Buy books button      | Open Chrome dev tools, navigate to application.<br>Click on the little arrow to the left of Cookies and click the option that drops down.<br>On the right hand side find sessionid, right click and delete. Back to website, navigate to basket | Message displayed with your bag is empty and button abck to books page                                                                                         | Pass      |                                                                                  |
| 5.2      | Basket Items                                             | Items in basket are displayed with price, quantity and subtotal                                            | Add books to basket<br>Navigate to basket page                                                                                                                                                                                                  | Items are displayed with price, quantity and subtotal                                                                                                          | Pass      |                                                                                  |
| 5.3      | Cover image                                              | Cover image only displays on tablet and laptop screens                                                     | Open Chrome dev tools<br>Select each screen size from mobile sm up to Laptop L                                                                                                                                                                  | Cover image doesn't display on smaller screens                                                                                                                 | Pass      |                                                                                  |
| 5.4      | Plus button                                              | Increase the quantity of books to add to basket.                                                           | Click plus button                                                                                                                                                                                                                               | Increases quantity                                                                                                                                             | Pass      |                                                                                  |
|          |                                                          | Button disables when the quantity  reaches 99                                                              | Enter 99 into the qty input box and try clicking the plus button                                                                                                                                                                                | Button disabled and colour is changed to reflect state                                                                                                         | Pass      |                                                                                  |
| 5.5      | Minus button                                             | Decrease the quantity of books to add to basket                                                            | Click minus button                                                                                                                                                                                                                              | Decreases quantity (if higher than 1 already)                                                                                                                  | Pass      |                                                                                  |
|          |                                                          | Button disables when the quantity  input reads 1 to avoid 0 or negative numbers being selected             |                                                                                                                                                                                                                                                 | Button disabled and colour is changed to reflect state                                                                                                         | Pass      |                                                                                  |
| 5.6      | Update link                                              | When quantity of item is updated and the update link is clicked the basket quantity updates                | Adjust the quantity of a book on the basket page<br>Click update link                                                                                                                                                                           | Basket quantity updates                                                                                                                                        | Pass      |                                                                                  |
| 5.7      | Remove link                                              | When clicked the book will be removed from the basket                                                      | Click remove link with an item in the basket                                                                                                                                                                                                    | Removes items                                                                                                                                                  | Pass      |                                                                                  |
| 5.8      | Continue shopping button                                 | When clicked will take the user to the books page                                                          | Click continue shopping button                                                                                                                                                                                                                  | Takes user to books                                                                                                                                            | Pass      |                                                                                  |
| 5.9      | Secure Checkout button                                   | Takes the user to the checkout page                                                                        | Click secure checkout                                                                                                                                                                                                                           |                                                                                                                                                                | Pass      |                                                                                  |
| 6        | CHECKOUT PAGE                                            |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 6.1      | Order summary accordion collapsed                        | Displays the header "Order Summary" along with the price                                                   | From basket click "Secure Checkout" button                                                                                                                                                                                                      | Displays as expected                                                                                                                                           | Pass      |                                                                                  |
|          | Order summary accordion expanded                         | Displays information on the books being ordered and a summary of charges                                   | Click the "Order Summary" heading on the accordion                                                                                                                                                                                              | Displays as expected                                                                                                                                           | Pass      |                                                                                  |
| 6.2      | Form Validation                                          | When mandatory fields are missing information a tooltip will show prompting the user to fill in the field  | Complete the form and leave data blank in fields marked with asteriks one at a time                                                                                                                                                             | Tooltips display as expected                                                                                                                                   | Pass      | When tested on Mobile small 320px in development the tooltips weren't displaying |
| 6.3      | Save delivery information to profile checkbox            | When checked the delivery information will send to user's profile                                          | Complete the form, check the box and make payment                                                                                                                                                                                               | Information saved as expected                                                                                                                                  | Pass      |                                                                                  |
| 6.4      | Stripe payment section                                   | Shows user feedback if a n incorrect card number is entered                                                | Enter invalid card number                                                                                                                                                                                                                       | Message displayed "card number is invalid"                                                                                                                     | Pass      |                                                                                  |
|          |                                                          | Shows user feedback if expiry date is a date that's already passed                                         | Choose expiry date that has already passed                                                                                                                                                                                                      | Message "your expiry date is in the past"                                                                                                                      | Pass      |                                                                                  |
|          |                                                          | shows user feedback if postcode is missing                                                                 | Complete payment form without postcode                                                                                                                                                                                                          | "your postal code is incomplete"                                                                                                                               | Pass      |                                                                                  |
|          |                                                          | Shows user feedback if CVC is missing                                                                      | Complete payment form without CVC                                                                                                                                                                                                               | "Your card's security code is incomplete."                                                                                                                     | Pass      |                                                                                  |
| 6.5      | Complete Order button                                    | Displays loading overlay and takes user to checkout success page                                           | Complete details and payment form fully and click "Complete Order"                                                                                                                                                                              | Payment completed as expected                                                                                                                                  | Pass      |                                                                                  |
| 6.6      | Amend Order button                                       | Takes user back to their basket to make adjustments                                                        | Click "Amend Order" button                                                                                                                                                                                                                      | Navigates to basket                                                                                                                                            | Pass      |                                                                                  |
| 7        | CHECKOUT SUCCESS PAGE                                    |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 7.1      | Home Button                                              | Takes users back to the home/books page                                                                    | Click "Home" button                                                                                                                                                                                                                             | Takes user to books                                                                                                                                            | Pass      |                                                                                  |
| 8        | PROFILE                                                  |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 8.1      | Update button                                            | Updates the delivery information form                                                                      | Fill out the Delivey info form and click "Update" button                                                                                                                                                                                        | Updates information as expected                                                                                                                                | Pass      |                                                                                  |
| 8.2      | Delivery Information form                                | Display user's saved information                                                                           | Check the save delivery info box when checking out                                                                                                                                                                                              | Updates as expected                                                                                                                                            | Pass      |                                                                                  |
| 8.3      | Order History                                            | Display's each purchase a user has made                                                                    | Log in, make a purchase and navigate to the profile page                                                                                                                                                                                        | Updates as expected                                                                                                                                            | Pass      |                                                                                  |
| 9        | BOOK ADMIN                                               |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
|          | Add book                                                 |                                                                                                            |                                                                                                                                                                                                                                                 |                                                                                                                                                                |           |                                                                                  |
| 9.1      | Add book nav link, edit book links and delete book links | Display to super users only and remain hidden when a regular user or non account holder is logged in       | Log out of all accounts                                                                                                                                                                                                                         | Book admin section isn't showing on nav bar and edit/delete icons not showing on all_books page or book summary page                                           | Pass      |                                                                                  |
| 9.2      | Form Validation                                          | Alert's user's of any fields that must be filled out                                                       | Try to complete form without filling all fields                                                                                                                                                                                                 | Tooltips pop up prompting the user to fill in the missing field                                                                                                | Fail      | The Title field doesn't seem to prompt the user with a tooltip                   |
| 9.3      | Date field Validation                                    | Reminds the user that their published date must be either today's date or in the past.                     | Select future date                                                                                                                                                                                                                              | Form fails, a pop up informs the user that the form was unable to send and a message displays under the message field in red to give the user more information |           |                                                                                  |
| 9.4      | Correctly submitted form                                 | Creates a new book displayed on the books page for site users to purchase                                  | Complete the form correctly                                                                                                                                                                                                                     | New book is created                                                                                                                                            | Pass      |                                                                                  |